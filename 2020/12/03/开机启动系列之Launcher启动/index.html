<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  
  <title>开机启动系列之Launcher启动 | Xlee</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="开机启动系列之Launcher启动，Android Q">
<meta name="keywords" content="ATV,Launcher,开机,启动">
<meta property="og:type" content="article">
<meta property="og:title" content="开机启动系列之Launcher启动">
<meta property="og:url" content="https//xlee00.github.io/2020/12/03/开机启动系列之Launcher启动/index.html">
<meta property="og:site_name" content="Xlee">
<meta property="og:description" content="开机启动系列之Launcher启动，Android Q">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-12-03T07:56:26.108Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开机启动系列之Launcher启动">
<meta name="twitter:description" content="开机启动系列之Launcher启动，Android Q">
  
    <link rel="alternate" href="/atom.xml" title="Xlee">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Xlee</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">与世界分享你的知识、经验和见解</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https//xlee00.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-开机启动系列之Launcher启动" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/03/开机启动系列之Launcher启动/" class="article-date">
  <time class="dt-published" datetime="2020-12-03T06:00:01.000Z" itemprop="datePublished">2020-12-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/科技/">科技</a>►<a class="article-category-link" href="/categories/科技/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      开机启动系列之Launcher启动
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>开机启动系列之Launcher启动，Android Q</p>
<a id="more"></a>

<p>我们知道SystemServer进程是Zygote通过fork调用启动的，SystemServer进程的启动过程中会调用其main静态方法，开始执行整个SystemServer的启动流程，在其中通过调用三个内部方法分别启动boot service、core service和other service。<br>在调用startOtherService方法中就会通过调用mActivityManagerService.systemReady()方法，而这个ActivityManagerService的systemReady函数就是启动Launcher的入口。</p>
<p>`frameworks/base/services/java/com/android/server/SystemServer.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">877</span>     <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startOtherServices</span><span class="params">()</span> </span>&#123;</span><br><span class="line">             ....</span><br><span class="line"><span class="number">2030</span>         <span class="comment">// We now tell the activity manager it is okay to run third party</span></span><br><span class="line"><span class="number">2031</span>         <span class="comment">// code.  It will call back into us once it has gotten to the state</span></span><br><span class="line"><span class="number">2032</span>         <span class="comment">// where third party code can really run (but before it has actually</span></span><br><span class="line"><span class="number">2033</span>         <span class="comment">// started launching the initial applications), for us to complete our</span></span><br><span class="line"><span class="number">2034</span>         <span class="comment">// initialization.</span></span><br><span class="line"><span class="number">2035</span>         mActivityManagerService.systemReady(() -&gt; &#123;</span><br><span class="line"><span class="number">2036</span>             Slog.i(TAG, <span class="string">"Making services ready"</span>);</span><br><span class="line"><span class="number">2037</span>             traceBeginAndSlog(<span class="string">"StartActivityManagerReadyPhase"</span>);</span><br><span class="line"><span class="number">2038</span>             mSystemServiceManager.startBootPhase(</span><br><span class="line"><span class="number">2039</span>                     SystemService.PHASE_ACTIVITY_MANAGER_READY);</span><br><span class="line"><span class="number">2040</span>             traceEnd();</span><br><span class="line"><span class="number">2041</span>             traceBeginAndSlog(<span class="string">"StartObservingNativeCrashes"</span>);</span><br><span class="line"><span class="number">2042</span>             <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">2043</span>                 mActivityManagerService.startObservingNativeCrashes();</span><br><span class="line"><span class="number">2044</span>             &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line"><span class="number">2045</span>                 reportWtf(<span class="string">"observing native crashes"</span>, e);</span><br><span class="line"><span class="number">2046</span>             &#125;</span><br><span class="line"><span class="number">2047</span>             traceEnd();</span><br><span class="line">             ....</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure>

<p>ActivityManagerService.systemReady()函数中将调用mAtmInternal.startHomeOnAllDisplays()方法</p>
<p><code>frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">8986</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">systemReady</span><span class="params">(<span class="keyword">final</span> Runnable goingCallback, TimingsTraceLog traceLog)</span> </span>&#123;</span><br><span class="line">             ....</span><br><span class="line"><span class="number">9080</span>         <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line"><span class="number">9081</span>             <span class="comment">// Only start up encryption-aware persistent apps; once user is</span></span><br><span class="line"><span class="number">9082</span>             <span class="comment">// unlocked we'll come back around and start unaware apps</span></span><br><span class="line"><span class="number">9083</span>             startPersistentApps(PackageManager.MATCH_DIRECT_BOOT_AWARE);</span><br><span class="line"><span class="number">9084</span></span><br><span class="line"><span class="number">9085</span>             <span class="comment">// Start up initial activity.</span></span><br><span class="line"><span class="number">9086</span>             mBooting = <span class="keyword">true</span>;</span><br><span class="line"><span class="number">9087</span>             <span class="comment">// Enable home activity for system user, so that the system can always boot. We don't</span></span><br><span class="line"><span class="number">9088</span>             <span class="comment">// do this when the system user is not setup since the setup wizard should be the one</span></span><br><span class="line"><span class="number">9089</span>             <span class="comment">// to handle home activity in this case.</span></span><br><span class="line"><span class="number">9090</span>             <span class="keyword">if</span> (UserManager.isSplitSystemUser() &amp;&amp;</span><br><span class="line"><span class="number">9091</span>                     Settings.Secure.getInt(mContext.getContentResolver(),</span><br><span class="line"><span class="number">9092</span>                          Settings.Secure.USER_SETUP_COMPLETE, <span class="number">0</span>) != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="number">9093</span>                 ComponentName cName = <span class="keyword">new</span> ComponentName(mContext, SystemUserHomeActivity.class);</span><br><span class="line"><span class="number">9094</span>                 <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">9095</span>                     AppGlobals.getPackageManager().setComponentEnabledSetting(cName,</span><br><span class="line"><span class="number">9096</span>                             PackageManager.COMPONENT_ENABLED_STATE_ENABLED, <span class="number">0</span>,</span><br><span class="line"><span class="number">9097</span>                             UserHandle.USER_SYSTEM);</span><br><span class="line"><span class="number">9098</span>                 &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line"><span class="number">9099</span>                     <span class="keyword">throw</span> e.rethrowAsRuntimeException();</span><br><span class="line"><span class="number">9100</span>                 &#125;</span><br><span class="line"><span class="number">9101</span>             &#125;</span><br><span class="line"><span class="number">9102</span>             mAtmInternal.startHomeOnAllDisplays(currentUserId, <span class="string">"systemReady"</span>);<span class="comment">//启动Launcher</span></span><br><span class="line">             &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">             <span class="comment">//获取mAtmInternal</span></span><br><span class="line"><span class="number">2529</span>         mAtmInternal = LocalServices.getService(ActivityTaskManagerInternal.class);<span class="comment">//获取mAtmInternal</span></span><br></pre></td></tr></table></figure>

<p>mAtmInternal 初始化的地方<br><code>frameworks/base/services/core/java/com/android/server/wm/ActivityTaskManagerService.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">685</span>     <span class="meta">@VisibleForTesting</span>(visibility = VisibleForTesting.Visibility.PACKAGE)</span><br><span class="line"> <span class="number">686</span>     <span class="function"><span class="keyword">public</span> <span class="title">ActivityTaskManagerService</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line"> <span class="number">687</span>         mContext = context;</span><br><span class="line"> <span class="number">688</span>         mFactoryTest = FactoryTest.getMode();</span><br><span class="line"> <span class="number">689</span>         mSystemThread = ActivityThread.currentActivityThread();</span><br><span class="line"> <span class="number">690</span>         mUiContext = mSystemThread.getSystemUiContext();</span><br><span class="line"> <span class="number">691</span>         mLifecycleManager = <span class="keyword">new</span> ClientLifecycleManager();</span><br><span class="line"> <span class="number">692</span>         mInternal = <span class="keyword">new</span> LocalService();<span class="comment">//初始化mInternal</span></span><br><span class="line"> <span class="number">693</span>         GL_ES_VERSION = SystemProperties.getInt(<span class="string">"ro.opengles.version"</span>, GL_ES_VERSION_UNDEFINED);</span><br><span class="line"> <span class="number">694</span>     &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="number">968</span>     <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">             <span class="comment">//将该服务放入LocalServices的静态Map中</span></span><br><span class="line"> <span class="number">969</span>         LocalServices.addService(ActivityTaskManagerInternal.class, mInternal);</span><br><span class="line"> <span class="number">970</span>     &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">//ActivityTaskManagerInternal 的实现类为 LocalService</span></span><br><span class="line"><span class="number">6078</span>     <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalService</span> <span class="keyword">extends</span> <span class="title">ActivityTaskManagerInternal</span> </span>&#123;</span><br><span class="line">             ....</span><br><span class="line"><span class="number">6691</span>         <span class="meta">@Override</span></span><br><span class="line"><span class="number">6692</span>         <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">startHomeOnAllDisplays</span><span class="params">(<span class="keyword">int</span> userId, String reason)</span> </span>&#123;<span class="comment">//这就是被调用的代码</span></span><br><span class="line"><span class="number">6693</span>             <span class="keyword">synchronized</span> (mGlobalLock) &#123;</span><br><span class="line">                     <span class="comment">//实际上执行的是RootActivityContainer.startHomeOnAllDisplays</span></span><br><span class="line"><span class="number">6694</span>                 <span class="keyword">return</span> mRootActivityContainer.startHomeOnAllDisplays(userId, reason);</span><br><span class="line"><span class="number">6695</span>             &#125;</span><br><span class="line"><span class="number">6696</span>         &#125;</span><br><span class="line">             ....</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">//初始化mRootActivityContainer的地方</span></span><br><span class="line"> <span class="number">807</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(IntentFirewall intentFirewall, PendingIntentController intentController,</span></span></span><br><span class="line"><span class="function"><span class="params"> <span class="number">808</span>             Looper looper)</span> </span>&#123;</span><br><span class="line"> <span class="number">809</span>         mH = <span class="keyword">new</span> H(looper);</span><br><span class="line"> <span class="number">810</span>         mUiHandler = <span class="keyword">new</span> UiHandler();</span><br><span class="line"> <span class="number">811</span>         mIntentFirewall = intentFirewall;</span><br><span class="line"> <span class="number">812</span>         <span class="keyword">final</span> File systemDir = SystemServiceManager.ensureSystemDir();</span><br><span class="line"> <span class="number">813</span>         mAppWarnings = <span class="keyword">new</span> AppWarnings(<span class="keyword">this</span>, mUiContext, mH, mUiHandler, systemDir);</span><br><span class="line"> <span class="number">814</span>         mCompatModePackages = <span class="keyword">new</span> CompatModePackages(<span class="keyword">this</span>, systemDir, mH);</span><br><span class="line"> <span class="number">815</span>         mPendingIntentController = intentController;</span><br><span class="line"> <span class="number">816</span></span><br><span class="line"> <span class="number">817</span>         mTempConfig.setToDefaults();</span><br><span class="line"> <span class="number">818</span>         mTempConfig.setLocales(LocaleList.getDefault());</span><br><span class="line"> <span class="number">819</span>         mConfigurationSeq = mTempConfig.seq = <span class="number">1</span>;</span><br><span class="line"> <span class="number">820</span>         mStackSupervisor = createStackSupervisor();</span><br><span class="line"> <span class="number">821</span>         mRootActivityContainer = <span class="keyword">new</span> RootActivityContainer(<span class="keyword">this</span>);<span class="comment">//初始化mRootActivityContainer</span></span><br><span class="line"> <span class="number">822</span>         mRootActivityContainer.onConfigurationChanged(mTempConfig);</span><br><span class="line"> <span class="number">823</span></span><br><span class="line"> <span class="number">824</span>         mTaskChangeNotificationController =</span><br><span class="line"> <span class="number">825</span>                 <span class="keyword">new</span> TaskChangeNotificationController(mGlobalLock, mStackSupervisor, mH);</span><br><span class="line"> <span class="number">826</span>         mLockTaskController = <span class="keyword">new</span> LockTaskController(mContext, mStackSupervisor, mH);</span><br><span class="line"> <span class="number">827</span>         mActivityStartController = <span class="keyword">new</span> ActivityStartController(<span class="keyword">this</span>);</span><br><span class="line"> <span class="number">828</span>         mRecentTasks = createRecentTasks();</span><br><span class="line"> <span class="number">829</span>         mStackSupervisor.setRecentTasks(mRecentTasks);</span><br><span class="line"> <span class="number">830</span>         mVrController = <span class="keyword">new</span> VrController(mGlobalLock);</span><br><span class="line"> <span class="number">831</span>         mKeyguardController = mStackSupervisor.getKeyguardController();</span><br><span class="line"> <span class="number">832</span>     &#125;</span><br></pre></td></tr></table></figure>

<p>RootActivityContainer.startHomeOnAllDisplays的实现如下</p>
<p><code>frameworks/base/services/core/java/com/android/server/wm/RootActivityContainer.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">332</span>     <span class="function"><span class="keyword">boolean</span> <span class="title">startHomeOnAllDisplays</span><span class="params">(<span class="keyword">int</span> userId, String reason)</span> </span>&#123;<span class="comment">//调用入口</span></span><br><span class="line"><span class="number">333</span>         <span class="keyword">boolean</span> homeStarted = <span class="keyword">false</span>;</span><br><span class="line"><span class="number">334</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = mActivityDisplays.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line"><span class="number">335</span>             <span class="keyword">final</span> <span class="keyword">int</span> displayId = mActivityDisplays.get(i).mDisplayId;</span><br><span class="line"><span class="number">336</span>             homeStarted |= startHomeOnDisplay(userId, reason, displayId);<span class="comment">//调用了startHomeOnDisplay</span></span><br><span class="line"><span class="number">337</span>         &#125;</span><br><span class="line"><span class="number">338</span>         <span class="keyword">return</span> homeStarted;</span><br><span class="line"><span class="number">339</span>     &#125;</span><br><span class="line">        ....</span><br><span class="line"><span class="number">350</span>     <span class="function"><span class="keyword">boolean</span> <span class="title">startHomeOnDisplay</span><span class="params">(<span class="keyword">int</span> userId, String reason, <span class="keyword">int</span> displayId)</span> </span>&#123;</span><br><span class="line"><span class="number">351</span>         <span class="keyword">return</span> startHomeOnDisplay(userId, reason, displayId, <span class="keyword">false</span> <span class="comment">/* allowInstrumenting */</span>,</span><br><span class="line"><span class="number">352</span>                 <span class="keyword">false</span> <span class="comment">/* fromHomeKey */</span>);<span class="comment">//跳转5个参数的startHomeOnDisplay方法</span></span><br><span class="line"><span class="number">353</span>     &#125;</span><br><span class="line"><span class="number">354</span></span><br><span class="line"><span class="number">355</span>     <span class="comment">/**</span></span><br><span class="line"><span class="comment">356      * This starts home activity on displays that can have system decorations based on displayId -</span></span><br><span class="line"><span class="comment">357      * Default display always use primary home component.</span></span><br><span class="line"><span class="comment">358      * For Secondary displays, the home activity must have category SECONDARY_HOME and then resolves</span></span><br><span class="line"><span class="comment">359      * according to the priorities listed below.</span></span><br><span class="line"><span class="comment">360      *  - If default home is not set, always use the secondary home defined in the config.</span></span><br><span class="line"><span class="comment">361      *  - Use currently selected primary home activity.</span></span><br><span class="line"><span class="comment">362      *  - Use the activity in the same package as currently selected primary home activity.</span></span><br><span class="line"><span class="comment">363      *    If there are multiple activities matched, use first one.</span></span><br><span class="line"><span class="comment">364      *  - Use the secondary home defined in the config.</span></span><br><span class="line"><span class="comment">365      */</span></span><br><span class="line"><span class="number">366</span>     <span class="function"><span class="keyword">boolean</span> <span class="title">startHomeOnDisplay</span><span class="params">(<span class="keyword">int</span> userId, String reason, <span class="keyword">int</span> displayId, <span class="keyword">boolean</span> allowInstrumenting,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="number">367</span>             <span class="keyword">boolean</span> fromHomeKey)</span> </span>&#123;<span class="comment">//最后执行代码的地方</span></span><br><span class="line"><span class="number">368</span>         <span class="comment">// Fallback to top focused display if the displayId is invalid.</span></span><br><span class="line"><span class="number">369</span>         <span class="keyword">if</span> (displayId == INVALID_DISPLAY) &#123;</span><br><span class="line"><span class="number">370</span>             displayId = getTopDisplayFocusedStack().mDisplayId;</span><br><span class="line"><span class="number">371</span>         &#125;</span><br><span class="line"><span class="number">372</span></span><br><span class="line"><span class="number">373</span>         Intent homeIntent = <span class="keyword">null</span>;<span class="comment">//保存Launcher的intent</span></span><br><span class="line"><span class="number">374</span>         ActivityInfo aInfo = <span class="keyword">null</span>;</span><br><span class="line"><span class="number">375</span>         <span class="keyword">if</span> (displayId == DEFAULT_DISPLAY) &#123;</span><br><span class="line">                <span class="comment">//162  ActivityTaskManagerService mService;</span></span><br><span class="line"><span class="number">376</span>             homeIntent = mService.getHomeIntent();<span class="comment">//获取Launcher的intent,</span></span><br><span class="line"><span class="number">377</span>             aInfo = resolveHomeActivity(userId, homeIntent);</span><br><span class="line"><span class="number">378</span>         &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shouldPlaceSecondaryHomeOnDisplay(displayId)) &#123;</span><br><span class="line">                <span class="comment">//获取Launcher的intent</span></span><br><span class="line"><span class="number">379</span>             Pair&lt;ActivityInfo, Intent&gt; info = resolveSecondaryHomeActivity(userId, displayId);</span><br><span class="line"><span class="number">380</span>             aInfo = info.first;</span><br><span class="line"><span class="number">381</span>             homeIntent = info.second;</span><br><span class="line"><span class="number">382</span>         &#125;</span><br><span class="line"><span class="number">383</span>         <span class="keyword">if</span> (aInfo == <span class="keyword">null</span> || homeIntent == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="number">384</span>             <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"><span class="number">385</span>         &#125;</span><br><span class="line"><span class="number">386</span></span><br><span class="line"><span class="number">387</span>         <span class="keyword">if</span> (!canStartHomeOnDisplay(aInfo, displayId, allowInstrumenting)) &#123;</span><br><span class="line"><span class="number">388</span>             <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"><span class="number">389</span>         &#125;</span><br><span class="line"><span class="number">390</span></span><br><span class="line"><span class="number">391</span>         <span class="comment">// Updates the home component of the intent.</span></span><br><span class="line"><span class="number">392</span>         homeIntent.setComponent(<span class="keyword">new</span> ComponentName(aInfo.applicationInfo.packageName, aInfo.name));</span><br><span class="line"><span class="number">393</span>         homeIntent.setFlags(homeIntent.getFlags() | FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line"><span class="number">394</span>         <span class="comment">// Updates the extra information of the intent.</span></span><br><span class="line"><span class="number">395</span>         <span class="keyword">if</span> (fromHomeKey) &#123;</span><br><span class="line"><span class="number">396</span>             homeIntent.putExtra(WindowManagerPolicy.EXTRA_FROM_HOME_KEY, <span class="keyword">true</span>);</span><br><span class="line"><span class="number">397</span>         &#125;</span><br><span class="line"><span class="number">398</span>         <span class="comment">// Update the reason for ANR debugging to verify if the user activity is the one that</span></span><br><span class="line"><span class="number">399</span>         <span class="comment">// actually launched.</span></span><br><span class="line"><span class="number">400</span>         <span class="keyword">final</span> String myReason = reason + <span class="string">":"</span> + userId + <span class="string">":"</span> + UserHandle.getUserId(</span><br><span class="line"><span class="number">401</span>                 aInfo.applicationInfo.uid) + <span class="string">":"</span> + displayId;</span><br><span class="line"><span class="number">402</span>         mService.getActivityStartController().startHomeActivity(homeIntent, aInfo, myReason,</span><br><span class="line"><span class="number">403</span>                 displayId);<span class="comment">//实际启动Launcher</span></span><br><span class="line"><span class="number">404</span>         <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"><span class="number">405</span>     &#125;</span><br><span class="line">        ....</span><br><span class="line">        <span class="comment">//获取Launcher Intent要启动的Activity</span></span><br><span class="line"><span class="number">407</span>     <span class="comment">/**</span></span><br><span class="line"><span class="comment">408      * This resolves the home activity info.</span></span><br><span class="line"><span class="comment">409      * <span class="doctag">@return</span> the home activity info if any.</span></span><br><span class="line"><span class="comment">410      */</span></span><br><span class="line"><span class="number">411</span>     <span class="meta">@VisibleForTesting</span></span><br><span class="line"><span class="number">412</span>     <span class="function">ActivityInfo <span class="title">resolveHomeActivity</span><span class="params">(<span class="keyword">int</span> userId, Intent homeIntent)</span> </span>&#123;</span><br><span class="line"><span class="number">413</span>         <span class="keyword">final</span> <span class="keyword">int</span> flags = ActivityManagerService.STOCK_PM_FLAGS;</span><br><span class="line"><span class="number">414</span>         <span class="keyword">final</span> ComponentName comp = homeIntent.getComponent();</span><br><span class="line"><span class="number">415</span>         ActivityInfo aInfo = <span class="keyword">null</span>;</span><br><span class="line"><span class="number">416</span>         <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">417</span>             <span class="keyword">if</span> (comp != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="number">418</span>                 <span class="comment">// Factory test.</span></span><br><span class="line"><span class="number">419</span>                 aInfo = AppGlobals.getPackageManager().getActivityInfo(comp, flags, userId);</span><br><span class="line"><span class="number">420</span>             &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="number">421</span>                 <span class="keyword">final</span> String resolvedType =</span><br><span class="line"><span class="number">422</span>                         homeIntent.resolveTypeIfNeeded(mService.mContext.getContentResolver());</span><br><span class="line"><span class="number">423</span>                 <span class="keyword">final</span> ResolveInfo info = AppGlobals.getPackageManager()</span><br><span class="line"><span class="number">424</span>                         .resolveIntent(homeIntent, resolvedType, flags, userId);</span><br><span class="line"><span class="number">425</span>                 <span class="keyword">if</span> (info != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="number">426</span>                     aInfo = info.activityInfo;</span><br><span class="line"><span class="number">427</span>                 &#125;</span><br><span class="line"><span class="number">428</span>             &#125;</span><br><span class="line"><span class="number">429</span>         &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line"><span class="number">430</span>             <span class="comment">// ignore</span></span><br><span class="line"><span class="number">431</span>         &#125;</span><br><span class="line"><span class="number">432</span></span><br><span class="line"><span class="number">433</span>         <span class="keyword">if</span> (aInfo == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="number">434</span>             Slog.wtf(TAG, <span class="string">"No home screen found for "</span> + homeIntent, <span class="keyword">new</span> Throwable());</span><br><span class="line"><span class="number">435</span>             <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"><span class="number">436</span>         &#125;</span><br><span class="line"><span class="number">437</span></span><br><span class="line"><span class="number">438</span>         aInfo = <span class="keyword">new</span> ActivityInfo(aInfo);</span><br><span class="line"><span class="number">439</span>         aInfo.applicationInfo = mService.getAppInfoForUser(aInfo.applicationInfo, userId);</span><br><span class="line"><span class="number">440</span>         <span class="keyword">return</span> aInfo;</span><br><span class="line"><span class="number">441</span>     &#125;</span><br></pre></td></tr></table></figure>

<p>ActivityTaskManagerService.getHomeIntent()实现如下</p>
<p><code>frameworks/base/services/core/java/com/android/server/wm/ActivityTaskManagerService.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5851</span>     <span class="function">Intent <span class="title">getHomeIntent</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">5852</span>         Intent intent = <span class="keyword">new</span> Intent(mTopAction, mTopData != <span class="keyword">null</span> ? Uri.parse(mTopData) : <span class="keyword">null</span>);</span><br><span class="line"><span class="number">5853</span>         intent.setComponent(mTopComponent);</span><br><span class="line"><span class="number">5854</span>         intent.addFlags(Intent.FLAG_DEBUG_TRIAGED_MISSING);</span><br><span class="line"><span class="number">5855</span>         <span class="keyword">if</span> (mFactoryTest != FactoryTest.FACTORY_TEST_LOW_LEVEL) &#123;</span><br><span class="line"><span class="number">5856</span>             intent.addCategory(Intent.CATEGORY_HOME);<span class="comment">//增加 HomeCategory,只有带了HomeCategory才是launcher</span></span><br><span class="line"><span class="number">5857</span>         &#125;</span><br><span class="line"><span class="number">5858</span>         <span class="keyword">return</span> intent;</span><br><span class="line"><span class="number">5859</span>     &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">6714</span>         <span class="meta">@Override</span> <span class="comment">//mTopComponent初始化的地方</span></span><br><span class="line"><span class="number">6715</span>         <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateTopComponentForFactoryTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">6716</span>             <span class="keyword">synchronized</span> (mGlobalLock) &#123;</span><br><span class="line"><span class="number">6717</span>                 <span class="keyword">if</span> (mFactoryTest != FACTORY_TEST_LOW_LEVEL) &#123;</span><br><span class="line"><span class="number">6718</span>                     <span class="keyword">return</span>;</span><br><span class="line"><span class="number">6719</span>                 &#125;</span><br><span class="line"><span class="number">6720</span>                 <span class="keyword">final</span> ResolveInfo ri = mContext.getPackageManager()</span><br><span class="line"><span class="number">6721</span>                         .resolveActivity(<span class="keyword">new</span> Intent(Intent.ACTION_FACTORY_TEST), STOCK_PM_FLAGS);</span><br><span class="line"><span class="number">6722</span>                 <span class="keyword">final</span> CharSequence errorMsg;</span><br><span class="line"><span class="number">6723</span>                 <span class="keyword">if</span> (ri != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="number">6724</span>                     <span class="keyword">final</span> ActivityInfo ai = ri.activityInfo;</span><br><span class="line"><span class="number">6725</span>                     <span class="keyword">final</span> ApplicationInfo app = ai.applicationInfo;</span><br><span class="line"><span class="number">6726</span>                     <span class="keyword">if</span> ((app.flags &amp; ApplicationInfo.FLAG_SYSTEM) != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="number">6727</span>                         mTopAction = Intent.ACTION_FACTORY_TEST;</span><br><span class="line"><span class="number">6728</span>                         mTopData = <span class="keyword">null</span>;</span><br><span class="line">                             <span class="comment">//初始化 mTopComponent</span></span><br><span class="line"><span class="number">6729</span>                         mTopComponent = <span class="keyword">new</span> ComponentName(app.packageName, ai.name);</span><br><span class="line"><span class="number">6730</span>                         errorMsg = <span class="keyword">null</span>;</span><br><span class="line"><span class="number">6731</span>                     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="number">6732</span>                         errorMsg = mContext.getResources().getText(</span><br><span class="line"><span class="number">6733</span>                                 com.android.internal.R.string.factorytest_not_system);</span><br><span class="line"><span class="number">6734</span>                     &#125;</span><br><span class="line"><span class="number">6735</span>                 &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="number">6736</span>                     errorMsg = mContext.getResources().getText(</span><br><span class="line"><span class="number">6737</span>                             com.android.internal.R.string.factorytest_no_action);</span><br><span class="line"><span class="number">6738</span>                 &#125;</span><br><span class="line"><span class="number">6739</span>                 <span class="keyword">if</span> (errorMsg == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="number">6740</span>                     <span class="keyword">return</span>;</span><br><span class="line"><span class="number">6741</span>                 &#125;</span><br><span class="line"><span class="number">6742</span></span><br><span class="line"><span class="number">6743</span>                 mTopAction = <span class="keyword">null</span>;</span><br><span class="line"><span class="number">6744</span>                 mTopData = <span class="keyword">null</span>;</span><br><span class="line"><span class="number">6745</span>                 mTopComponent = <span class="keyword">null</span>;</span><br><span class="line"><span class="number">6746</span>                 mUiHandler.post(() -&gt; &#123;</span><br><span class="line"><span class="number">6747</span>                     Dialog d = <span class="keyword">new</span> FactoryErrorDialog(mUiContext, errorMsg);</span><br><span class="line"><span class="number">6748</span>                     d.show();</span><br><span class="line"><span class="number">6749</span>                     mAmInternal.ensureBootCompleted();</span><br><span class="line"><span class="number">6750</span>                 &#125;);</span><br><span class="line"><span class="number">6751</span>             &#125;</span><br><span class="line"><span class="number">6752</span>         &#125;</span><br></pre></td></tr></table></figure>

<p>ActivityStartController.startHomeActivity</p>
<p><code>frameworks/base/services/core/java/com/android/server/wm/ActivityStartController.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">171</span>     <span class="function"><span class="keyword">void</span> <span class="title">startHomeActivity</span><span class="params">(Intent intent, ActivityInfo aInfo, String reason, <span class="keyword">int</span> displayId)</span> </span>&#123;</span><br><span class="line"><span class="number">172</span>         <span class="keyword">final</span> ActivityOptions options = ActivityOptions.makeBasic();</span><br><span class="line"><span class="number">173</span>         options.setLaunchWindowingMode(WINDOWING_MODE_FULLSCREEN);</span><br><span class="line"><span class="number">174</span>         <span class="keyword">if</span> (!ActivityRecord.isResolverActivity(aInfo.name)) &#123;</span><br><span class="line"><span class="number">175</span>             <span class="comment">// The resolver activity shouldn't be put in home stack because when the foreground is</span></span><br><span class="line"><span class="number">176</span>             <span class="comment">// standard type activity, the resolver activity should be put on the top of current</span></span><br><span class="line"><span class="number">177</span>             <span class="comment">// foreground instead of bring home stack to front.</span></span><br><span class="line"><span class="number">178</span>             options.setLaunchActivityType(ACTIVITY_TYPE_HOME);</span><br><span class="line"><span class="number">179</span>         &#125;</span><br><span class="line"><span class="number">180</span>         options.setLaunchDisplayId(displayId);</span><br><span class="line"><span class="number">181</span>         mLastHomeActivityStartResult = obtainStarter(intent, <span class="string">"startHomeActivity: "</span> + reason)</span><br><span class="line"><span class="number">182</span>                 .setOutActivity(tmpOutRecord)</span><br><span class="line"><span class="number">183</span>                 .setCallingUid(<span class="number">0</span>)</span><br><span class="line"><span class="number">184</span>                 .setActivityInfo(aInfo)</span><br><span class="line"><span class="number">185</span>                 .setActivityOptions(options.toBundle())</span><br><span class="line"><span class="number">186</span>                 .execute();<span class="comment">//使用Starter启动Activity</span></span><br><span class="line"><span class="number">187</span>         mLastHomeActivityStartRecord = tmpOutRecord[<span class="number">0</span>];</span><br><span class="line"><span class="number">188</span>         <span class="keyword">final</span> ActivityDisplay display =</span><br><span class="line"><span class="number">189</span>                 mService.mRootActivityContainer.getActivityDisplay(displayId);</span><br><span class="line"><span class="number">190</span>         <span class="keyword">final</span> ActivityStack homeStack = display != <span class="keyword">null</span> ? display.getHomeStack() : <span class="keyword">null</span>;</span><br><span class="line"><span class="number">191</span>         <span class="keyword">if</span> (homeStack != <span class="keyword">null</span> &amp;&amp; homeStack.mInResumeTopActivity) &#123;</span><br><span class="line"><span class="number">192</span>             <span class="comment">// If we are in resume section already, home activity will be initialized, but not</span></span><br><span class="line"><span class="number">193</span>             <span class="comment">// resumed (to avoid recursive resume) and will stay that way until something pokes it</span></span><br><span class="line"><span class="number">194</span>             <span class="comment">// again. We need to schedule another resume.</span></span><br><span class="line"><span class="number">195</span>             mSupervisor.scheduleResumeTopActivities();</span><br><span class="line"><span class="number">196</span>         &#125;</span><br><span class="line"><span class="number">197</span>     &#125;</span><br><span class="line">		....</span><br><span class="line"><span class="number">140</span>     <span class="comment">/**</span></span><br><span class="line"><span class="comment">141      * <span class="doctag">@return</span> A starter to configure and execute starting an activity. It is valid until after</span></span><br><span class="line"><span class="comment">142      *         &#123;<span class="doctag">@link</span> ActivityStarter#execute&#125; is invoked. At that point, the starter should be</span></span><br><span class="line"><span class="comment">143      *         considered invalid and no longer modified or used.</span></span><br><span class="line"><span class="comment">144      */</span></span><br><span class="line"><span class="number">145</span>     <span class="function">ActivityStarter <span class="title">obtainStarter</span><span class="params">(Intent intent, String reason)</span> </span>&#123;<span class="comment">//获取Starter的方法</span></span><br><span class="line"><span class="number">146</span>         <span class="keyword">return</span> mFactory.obtain().setIntent(intent).setReason(reason);</span><br><span class="line"><span class="number">147</span>     &#125;</span><br></pre></td></tr></table></figure>

<p>可以看到ActivityStartContriller是通过obtainStarter().execute()来启动Launcher的主activity的，而obtainStarter()返回的就是ActivityStarter对象。</p>
<p><code>frameworks/base/services/core/java/com/android/server/wm/ActivityStarter.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">506</span>      * Starts an activity based on the request parameters provided earlier.</span><br><span class="line"><span class="number">507</span>      * <span class="meta">@return</span> The starter result.</span><br><span class="line"><span class="number">508</span>      */</span><br><span class="line"><span class="number">509</span>     <span class="function"><span class="keyword">int</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">510</span>         <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">511</span>             <span class="comment">// TODO(b/64750076): Look into passing request directly to these methods to allow</span></span><br><span class="line"><span class="number">512</span>             <span class="comment">// for transactional diffs and preprocessing.</span></span><br><span class="line"><span class="number">513</span>             <span class="keyword">if</span> (mRequest.mayWait) &#123;</span><br><span class="line"><span class="number">514</span>                 <span class="keyword">return</span> startActivityMayWait(mRequest.caller, mRequest.callingUid,</span><br><span class="line"><span class="number">515</span>                         mRequest.callingPackage, mRequest.realCallingPid, mRequest.realCallingUid,</span><br><span class="line"><span class="number">516</span>                         mRequest.intent, mRequest.resolvedType,</span><br><span class="line"><span class="number">517</span>                         mRequest.voiceSession, mRequest.voiceInteractor, mRequest.resultTo,</span><br><span class="line"><span class="number">518</span>                         mRequest.resultWho, mRequest.requestCode, mRequest.startFlags,</span><br><span class="line"><span class="number">519</span>                         mRequest.profilerInfo, mRequest.waitResult, mRequest.globalConfig,</span><br><span class="line"><span class="number">520</span>                         mRequest.activityOptions, mRequest.ignoreTargetSecurity, mRequest.userId,</span><br><span class="line"><span class="number">521</span>                         mRequest.inTask, mRequest.reason,</span><br><span class="line"><span class="number">522</span>                         mRequest.allowPendingRemoteAnimationRegistryLookup,</span><br><span class="line"><span class="number">523</span>                         mRequest.originatingPendingIntent, mRequest.allowBackgroundActivityStart);</span><br><span class="line"><span class="number">524</span>             &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="number">525</span>                 <span class="keyword">return</span> startActivity(mRequest.caller, mRequest.intent, mRequest.ephemeralIntent,</span><br><span class="line"><span class="number">526</span>                         mRequest.resolvedType, mRequest.activityInfo, mRequest.resolveInfo,</span><br><span class="line"><span class="number">527</span>                         mRequest.voiceSession, mRequest.voiceInteractor, mRequest.resultTo,</span><br><span class="line"><span class="number">528</span>                         mRequest.resultWho, mRequest.requestCode, mRequest.callingPid,</span><br><span class="line"><span class="number">529</span>                         mRequest.callingUid, mRequest.callingPackage, mRequest.realCallingPid,</span><br><span class="line"><span class="number">530</span>                         mRequest.realCallingUid, mRequest.startFlags, mRequest.activityOptions,</span><br><span class="line"><span class="number">531</span>                         mRequest.ignoreTargetSecurity, mRequest.componentSpecified,</span><br><span class="line"><span class="number">532</span>                         mRequest.outActivity, mRequest.inTask, mRequest.reason,</span><br><span class="line"><span class="number">533</span>                         mRequest.allowPendingRemoteAnimationRegistryLookup,</span><br><span class="line"><span class="number">534</span>                         mRequest.originatingPendingIntent, mRequest.allowBackgroundActivityStart);</span><br><span class="line"><span class="number">535</span>             &#125;</span><br><span class="line"><span class="number">536</span>         &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="number">537</span>             onExecutionComplete();</span><br><span class="line"><span class="number">538</span>         &#125;</span><br><span class="line"><span class="number">539</span>     &#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https//xlee00.github.io/2020/12/03/开机启动系列之Launcher启动/" data-id="ckjnv0n63004nron562qvw7ka" data-title="开机启动系列之Launcher启动" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ATV/">ATV</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Launcher/">Launcher</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/启动/">启动</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/开机/">开机</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/12/28/通过Shell脚本读取properties文件中的参数时遇到-r换行符的问题/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          通过Shell脚本读取properties文件中的参数时遇到换行符的问题
        
      </div>
    </a>
  
  
    <a href="/2020/11/24/ATV测试总结/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">ATV测试总结</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/人文/">人文</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/人文/人文其它/">人文其它</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂谈/">杂谈</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/科技/">科技</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/科技/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/科技/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/科技/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/科技/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/科技/Others/">Others</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/科技/Raspberry/">Raspberry</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/科技/Ubuntu/">Ubuntu</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/科技/Wordpress/">Wordpress</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/科技/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/科技/svn/">svn</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/7z/" style="font-size: 10px;">7z</a> <a href="/tags/ATV/" style="font-size: 12px;">ATV</a> <a href="/tags/Android-TV/" style="font-size: 10px;">Android TV</a> <a href="/tags/Code-review/" style="font-size: 10px;">Code review</a> <a href="/tags/Fragment/" style="font-size: 10px;">Fragment</a> <a href="/tags/Gerrit/" style="font-size: 10px;">Gerrit</a> <a href="/tags/Git/" style="font-size: 20px;">Git</a> <a href="/tags/Github/" style="font-size: 12px;">Github</a> <a href="/tags/Gitignore/" style="font-size: 10px;">Gitignore</a> <a href="/tags/Google-Play/" style="font-size: 10px;">Google Play</a> <a href="/tags/Google-billing/" style="font-size: 10px;">Google billing</a> <a href="/tags/Google-payment/" style="font-size: 10px;">Google payment</a> <a href="/tags/Gz/" style="font-size: 10px;">Gz</a> <a href="/tags/Hexo/" style="font-size: 12px;">Hexo</a> <a href="/tags/IP/" style="font-size: 10px;">IP</a> <a href="/tags/LFS/" style="font-size: 10px;">LFS</a> <a href="/tags/LNMP/" style="font-size: 10px;">LNMP</a> <a href="/tags/Launcher/" style="font-size: 14px;">Launcher</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/OpenVPN/" style="font-size: 10px;">OpenVPN</a> <a href="/tags/Rar/" style="font-size: 10px;">Rar</a> <a href="/tags/Raspberry/" style="font-size: 14px;">Raspberry</a> <a href="/tags/RecyclerView/" style="font-size: 10px;">RecyclerView</a> <a href="/tags/Response/" style="font-size: 10px;">Response</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/ScrollBar/" style="font-size: 10px;">ScrollBar</a> <a href="/tags/Scrollbar/" style="font-size: 10px;">Scrollbar</a> <a href="/tags/SparseArray/" style="font-size: 12px;">SparseArray</a> <a href="/tags/SparseArrayCompat/" style="font-size: 10px;">SparseArrayCompat</a> <a href="/tags/Supervisor/" style="font-size: 10px;">Supervisor</a> <a href="/tags/Tar/" style="font-size: 10px;">Tar</a> <a href="/tags/Tar-gz/" style="font-size: 10px;">Tar.gz</a> <a href="/tags/Ubuntu/" style="font-size: 18px;">Ubuntu</a> <a href="/tags/Unpacker-error/" style="font-size: 10px;">Unpacker error</a> <a href="/tags/Unrar/" style="font-size: 10px;">Unrar</a> <a href="/tags/Vim/" style="font-size: 12px;">Vim</a> <a href="/tags/WIFI/" style="font-size: 10px;">WIFI</a> <a href="/tags/WPS/" style="font-size: 10px;">WPS</a> <a href="/tags/WSL/" style="font-size: 10px;">WSL</a> <a href="/tags/War/" style="font-size: 10px;">War</a> <a href="/tags/Win10/" style="font-size: 10px;">Win10</a> <a href="/tags/Wordpress/" style="font-size: 10px;">Wordpress</a> <a href="/tags/Xz/" style="font-size: 10px;">Xz</a> <a href="/tags/YAML/" style="font-size: 10px;">YAML</a> <a href="/tags/Zip/" style="font-size: 10px;">Zip</a> <a href="/tags/aar/" style="font-size: 10px;">aar</a> <a href="/tags/adb/" style="font-size: 10px;">adb</a> <a href="/tags/android/" style="font-size: 16px;">android</a> <a href="/tags/apk/" style="font-size: 10px;">apk</a> <a href="/tags/apply/" style="font-size: 10px;">apply</a> <a href="/tags/bash/" style="font-size: 12px;">bash</a> <a href="/tags/bat/" style="font-size: 10px;">bat</a> <a href="/tags/billing-test/" style="font-size: 10px;">billing test</a> <a href="/tags/bz2/" style="font-size: 10px;">bz2</a> <a href="/tags/centos/" style="font-size: 10px;">centos</a> <a href="/tags/cpu/" style="font-size: 10px;">cpu</a> <a href="/tags/drawable/" style="font-size: 10px;">drawable</a> <a href="/tags/eclipse/" style="font-size: 10px;">eclipse</a> <a href="/tags/egrep/" style="font-size: 10px;">egrep</a> <a href="/tags/emmc/" style="font-size: 10px;">emmc</a> <a href="/tags/fgrep/" style="font-size: 10px;">fgrep</a> <a href="/tags/gradle/" style="font-size: 10px;">gradle</a> <a href="/tags/grep/" style="font-size: 10px;">grep</a> <a href="/tags/hardware/" style="font-size: 10px;">hardware</a> <a href="/tags/import/" style="font-size: 10px;">import</a> <a href="/tags/keystore/" style="font-size: 10px;">keystore</a> <a href="/tags/merge/" style="font-size: 10px;">merge</a> <a href="/tags/monkey/" style="font-size: 10px;">monkey</a> <a href="/tags/netflix/" style="font-size: 10px;">netflix</a> <a href="/tags/no-permission/" style="font-size: 10px;">no_permission</a> <a href="/tags/notifyItemChanged/" style="font-size: 10px;">notifyItemChanged</a> <a href="/tags/screenshot/" style="font-size: 10px;">screenshot</a> <a href="/tags/sspanel/" style="font-size: 10px;">sspanel</a> <a href="/tags/state/" style="font-size: 10px;">state</a> <a href="/tags/supervisor/" style="font-size: 10px;">supervisor</a> <a href="/tags/svn/" style="font-size: 12px;">svn</a> <a href="/tags/tgz/" style="font-size: 10px;">tgz</a> <a href="/tags/three-way/" style="font-size: 10px;">three-way</a> <a href="/tags/win10/" style="font-size: 10px;">win10</a> <a href="/tags/不对称/" style="font-size: 10px;">不对称</a> <a href="/tags/乱码/" style="font-size: 12px;">乱码</a> <a href="/tags/代码仓库/" style="font-size: 10px;">代码仓库</a> <a href="/tags/位置/" style="font-size: 10px;">位置</a> <a href="/tags/信息/" style="font-size: 10px;">信息</a> <a href="/tags/修改文件名/" style="font-size: 10px;">修改文件名</a> <a href="/tags/出栈/" style="font-size: 10px;">出栈</a> <a href="/tags/制作/" style="font-size: 10px;">制作</a> <a href="/tags/加密/" style="font-size: 12px;">加密</a> <a href="/tags/博客/" style="font-size: 16px;">博客</a> <a href="/tags/原理/" style="font-size: 12px;">原理</a> <a href="/tags/后台/" style="font-size: 10px;">后台</a> <a href="/tags/启动/" style="font-size: 10px;">启动</a> <a href="/tags/启动方式/" style="font-size: 10px;">启动方式</a> <a href="/tags/命令/" style="font-size: 12px;">命令</a> <a href="/tags/回退/" style="font-size: 10px;">回退</a> <a href="/tags/多个图标/" style="font-size: 10px;">多个图标</a> <a href="/tags/大小写/" style="font-size: 10px;">大小写</a> <a href="/tags/字体/" style="font-size: 10px;">字体</a> <a href="/tags/字符编码/" style="font-size: 10px;">字符编码</a> <a href="/tags/客户端/" style="font-size: 10px;">客户端</a> <a href="/tags/对称/" style="font-size: 10px;">对称</a> <a href="/tags/库/" style="font-size: 10px;">库</a> <a href="/tags/开机/" style="font-size: 10px;">开机</a> <a href="/tags/快捷方式/" style="font-size: 10px;">快捷方式</a> <a href="/tags/快捷键/" style="font-size: 10px;">快捷键</a> <a href="/tags/截屏/" style="font-size: 10px;">截屏</a> <a href="/tags/批量/" style="font-size: 10px;">批量</a> <a href="/tags/显示隐藏/" style="font-size: 10px;">显示隐藏</a> <a href="/tags/更改icon/" style="font-size: 10px;">更改icon</a> <a href="/tags/杂谈/" style="font-size: 10px;">杂谈</a> <a href="/tags/权限/" style="font-size: 10px;">权限</a> <a href="/tags/模版/" style="font-size: 10px;">模版</a> <a href="/tags/注释头/" style="font-size: 10px;">注释头</a> <a href="/tags/测试/" style="font-size: 12px;">测试</a> <a href="/tags/滚动条/" style="font-size: 10px;">滚动条</a> <a href="/tags/白名单/" style="font-size: 10px;">白名单</a> <a href="/tags/监听/" style="font-size: 10px;">监听</a> <a href="/tags/科学上网/" style="font-size: 10px;">科学上网</a> <a href="/tags/签名/" style="font-size: 14px;">签名</a> <a href="/tags/系统开发/" style="font-size: 10px;">系统开发</a> <a href="/tags/编码转换/" style="font-size: 10px;">编码转换</a> <a href="/tags/编辑器/" style="font-size: 10px;">编辑器</a> <a href="/tags/脚本/" style="font-size: 10px;">脚本</a> <a href="/tags/自定义/" style="font-size: 10px;">自定义</a> <a href="/tags/行号/" style="font-size: 10px;">行号</a> <a href="/tags/补丁/" style="font-size: 12px;">补丁</a> <a href="/tags/语言/" style="font-size: 10px;">语言</a> <a href="/tags/语言列表/" style="font-size: 10px;">语言列表</a> <a href="/tags/软键盘/" style="font-size: 10px;">软键盘</a> <a href="/tags/过滤/" style="font-size: 10px;">过滤</a> <a href="/tags/运营商定制/" style="font-size: 10px;">运营商定制</a> <a href="/tags/运行慢/" style="font-size: 12px;">运行慢</a> <a href="/tags/门字不正确/" style="font-size: 10px;">门字不正确</a> <a href="/tags/非对称/" style="font-size: 10px;">非对称</a> <a href="/tags/默认/" style="font-size: 10px;">默认</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">九月 2014</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/01/08/修改Hexo网页中引用的显示/">修改Hexo网页中引用的显示</a>
          </li>
        
          <li>
            <a href="/2021/01/08/手动下载安装WSL/">手动下载安装WSL</a>
          </li>
        
          <li>
            <a href="/2020/12/28/通过Shell脚本读取properties文件中的参数时遇到-r换行符的问题/">通过Shell脚本读取properties文件中的参数时遇到换行符的问题</a>
          </li>
        
          <li>
            <a href="/2020/12/03/开机启动系列之Launcher启动/">开机启动系列之Launcher启动</a>
          </li>
        
          <li>
            <a href="/2020/11/24/ATV测试总结/">ATV测试总结</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 Xlee<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="/js/jquery-3.4.1.min.js"></script>


  <script src="/fancybox/jquery.fancybox.min.js"></script>


<script src="/js/script.js"></script>




  </div>
</body>
</html>